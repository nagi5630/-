# streamlit_future_trade_patterns_30.py
# æœªæ¥ãƒ‘ã‚¿ãƒ¼ãƒ³äºˆæ¸¬ï¼ˆ30ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰+ ä¿¡é ¼åº¦ + ã‚¨ãƒ³ãƒˆãƒªãƒ¼/åˆ©ç¢º/æåˆ‡ã‚Š + çŸ¢å°å¯è¦–åŒ–ï¼ˆStreamlitï¼‰
# ä¾å­˜: streamlit, yfinance, pandas, numpy, matplotlib

import streamlit as st
import yfinance as yf
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import japanize_matplotlib 

st.set_page_config(page_title="æ ªä¾¡æœªæ¥ãƒ‘ã‚¿ãƒ¼ãƒ³äºˆæ¸¬ï¼ˆ30ï¼‰", layout="wide")
st.title("ğŸ“ˆ æ ªä¾¡æœªæ¥ãƒ‘ã‚¿ãƒ¼ãƒ³äºˆæ¸¬ï¼ˆ30ãƒ‘ã‚¿ãƒ¼ãƒ³å¯¾å¿œï¼‰")

# ------------------- ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ -------------------
def safe_last_value(v):
    if isinstance(v, pd.DataFrame):
        if v.empty: return None
        return safe_last_value(v.iloc[-1,0])
    if isinstance(v, pd.Series):
        if v.empty: return None
        return safe_last_value(v.iloc[-1])
    if isinstance(v,(list,tuple,np.ndarray)):
        if len(v)==0: return None
        return safe_last_value(v[-1])
    return v

def format_price(v):
    v = safe_last_value(v)
    if v is None: return "N/A"
    try:
        return f"{float(v):,.2f}"
    except:
        return str(v)

def pct(a,b):
    try:
        a=float(a); b=float(b)
        if a==0: return 0.0
        return abs(a-b)/abs(a)*100.0
    except:
        return 0.0

def calc_sma(series, period):
    return series.rolling(period,min_periods=1).mean()

def calc_ema(series, period):
    return series.ewm(span=period, adjust=False, min_periods=1).mean()

def calc_rsi(series, period=14):
    delta = series.diff()
    gain = delta.where(delta>0,0.0)
    loss = -delta.where(delta<0,0.0)
    avg_gain = gain.rolling(period,min_periods=1).mean()
    avg_loss = loss.rolling(period,min_periods=1).mean()
    rs = avg_gain/(avg_loss.replace(0,np.nan))
    rsi = 100-(100/(1+rs))
    return rsi.fillna(50.0)

def calc_atr(df, period=14):
    high = df['High'].astype(float)
    low = df['Low'].astype(float)
    close = df['Close'].astype(float)
    prev_close = close.shift(1)
    tr = pd.concat([
        (high-low).abs(),
        (high-prev_close).abs(),
        (low-prev_close).abs()
    ], axis=1).max(axis=1)
    return tr.rolling(period, min_periods=1).mean()

# ------------------- æœªæ¥ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‹ãƒˆãƒ¬ãƒ¼ãƒ‰ç›®å®‰ -------------------
def predict_future_trade_patterns(df, lookback=60, risk_mult=1.0, use_atr=True):
    # å…¥åŠ›ãƒ™ãƒ¼ã‚¹
    closes = df['Close'].values.astype(float)
    highs = df['High'].values.astype(float)
    lows = df['Low'].values.astype(float)

    last_close = float(closes[-1])
    recent_c = closes[-lookback:]
    recent_h = highs[-lookback:]
    recent_l = lows[-lookback:]
    recent_high = float(recent_h.max())
    recent_low = float(recent_l.min())
    mid_range = (recent_high + recent_low)/2.0

    sma5 = float(calc_sma(df['Close'],5).iloc[-1])
    sma20 = float(calc_sma(df['Close'],20).iloc[-1])
    sma50 = float(calc_sma(df['Close'],50).iloc[-1])
    ema21 = float(calc_ema(df['Close'],21).iloc[-1])
    rsi = float(calc_rsi(df['Close']).iloc[-1])
    atr = float(calc_atr(df).iloc[-1]) if use_atr else max(1.0, last_close*0.01)

    trend_up = last_close > sma20 > sma50
    trend_dn = last_close < sma20 < sma50

    patterns = []

    # å…±é€š: ã‚¨ãƒ³ãƒˆãƒªãƒ¼/TP/SLè¨ˆç®—
    def trade_levels(kind: str, target_price: float, basis: float=None):
        basis = float(basis if basis is not None else last_close)
        # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: ATR ã‚’åˆ©ç”¨
        if kind == 'ä¸Šæ˜‡':
            entry = basis * (1 - 0.005)
            sl = entry - atr * 1.5 * risk_mult
            tp = float(target_price) if target_price is not None else entry + atr * 2.5 * risk_mult
        else:
            entry = basis * (1 + 0.005)
            sl = entry + atr * 1.5 * risk_mult
            tp = float(target_price) if target_price is not None else entry - atr * 2.5 * risk_mult
        return float(entry), float(tp), float(sl)

    def add_pattern(name, kind, confidence, target=None, basis=None):
        entry, tp, sl = trade_levels(kind, target, basis)
        rr = abs(tp - entry) / max(1e-9, abs(entry - sl))
        patterns.append({
            'name': name,
            'kind': kind,
            'confidence': int(confidence),
            'entry': entry,
            'tp': tp,
            'sl': sl,
            'rr': rr,
            'target': tp  # è¡¨ç¤ºç”¨ã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã¯åˆ©ç¢ºç›®å®‰
        })

    # ãƒ˜ãƒ«ãƒ‘ãƒ¼: å°ã•ãªãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
    def local_max(a):
        return a[-2] > a[-3] and a[-2] > a[-1]
    def local_min(a):
        return a[-2] < a[-3] and a[-2] < a[-1]

    # ------------------- ã“ã“ã‹ã‚‰ 30 ãƒ‘ã‚¿ãƒ¼ãƒ³ -------------------
    a = recent_c  # çœç•¥å

    # 1-2 ãƒ€ãƒ–ãƒ«ãƒˆãƒƒãƒ—/ãƒ€ãƒ–ãƒ«ãƒœãƒˆãƒ 
    if len(a) >= 3 and local_max(a):
        target = recent_low - (recent_high - recent_low) * 0.6
        conf = 62 + (1 if trend_dn else -1) + (1 if rsi>65 else 0)
        add_pattern('ãƒ€ãƒ–ãƒ«ãƒˆãƒƒãƒ—', 'ä¸‹è½', conf, target)
    if len(a) >= 3 and local_min(a):
        target = recent_high + (recent_high - recent_low) * 0.6
        conf = 62 + (1 if trend_up else -1) + (1 if rsi<35 else 0)
        add_pattern('ãƒ€ãƒ–ãƒ«ãƒœãƒˆãƒ ', 'ä¸Šæ˜‡', conf, target)

    # 3-4 ãƒˆãƒªãƒ—ãƒ«ãƒˆãƒƒãƒ—/ãƒˆãƒªãƒ—ãƒ«ãƒœãƒˆãƒ ï¼ˆä¸­å¤®ä»˜è¿‘ã‚’åŸºæº–ï¼‰
    if len(a) >= 5:
        mid = float(a[-3])
        if mid == max(a[-5:]):
            target = recent_low - (mid - recent_low) * 0.7
            add_pattern('ãƒˆãƒªãƒ—ãƒ«ãƒˆãƒƒãƒ—', 'ä¸‹è½', 60, target)
        if mid == min(a[-5:]):
            target = recent_high + (recent_high - mid) * 0.7
            add_pattern('ãƒˆãƒªãƒ—ãƒ«ãƒœãƒˆãƒ ', 'ä¸Šæ˜‡', 60, target)

    # 5-6 H&S / é€†H&S ï¼ˆ7æœ¬çª“ï¼‰
    if len(a) >= 7:
        mid = float(a[-4])
        if mid == max(a[-7:]) and trend_dn:
            target = recent_low - (mid - recent_low)
            add_pattern('ãƒ˜ãƒƒãƒ‰ï¼†ã‚·ãƒ§ãƒ«ãƒ€ãƒ¼', 'ä¸‹è½', 61, target)
        if mid == min(a[-7:]) and trend_up:
            target = recent_high + (recent_high - mid)
            add_pattern('é€†ãƒ˜ãƒƒãƒ‰ï¼†ã‚·ãƒ§ãƒ«ãƒ€ãƒ¼', 'ä¸Šæ˜‡', 61, target)

    # 7-8 ã‚½ãƒ¼ã‚µãƒ¼/ãƒ©ã‚¦ãƒ³ãƒ‰ãƒˆãƒƒãƒ—ï¼ˆ10æœ¬ä¸­å¤®å€¤ï¼‰
    if len(a) >= 10:
        mid = float(a[-5])
        if mid == min(a[-10:]):
            target = recent_high + (recent_high - mid) * 0.8
            add_pattern('ã‚½ãƒ¼ã‚µãƒ¼å‹', 'ä¸Šæ˜‡', 57, target)
        if mid == max(a[-10:]):
            target = recent_low - (mid - recent_low) * 0.8
            add_pattern('ãƒ©ã‚¦ãƒ³ãƒ‰ãƒˆãƒƒãƒ—å‹', 'ä¸‹è½', 57, target)

    # 9-10 ãƒ•ãƒ©ãƒƒã‚°ï¼ˆä¸Šæ˜‡/ä¸‹é™ï¼‰
    if last_close > sma5:
        add_pattern('ãƒ•ãƒ©ãƒƒã‚°ä¸Šæ˜‡', 'ä¸Šæ˜‡', 53, last_close + atr * 2.0)
    else:
        add_pattern('ãƒ•ãƒ©ãƒƒã‚°ä¸‹é™', 'ä¸‹è½', 53, last_close - atr * 2.0)

    # 11-12 ãƒšãƒŠãƒ³ãƒˆï¼ˆä¸Šæ˜‡/ä¸‹é™ï¼‰
    if abs(last_close - sma5)/max(1e-9, sma5) < 0.01:
        if trend_up:
            add_pattern('ãƒšãƒŠãƒ³ãƒˆä¸Šæ˜‡', 'ä¸Šæ˜‡', 52, last_close + atr * 1.8)
        if trend_dn:
            add_pattern('ãƒšãƒŠãƒ³ãƒˆä¸‹é™', 'ä¸‹è½', 52, last_close - atr * 1.8)

    # 13-14 Vå­—/é€†Vå­—
    if len(a) >= 3 and a[-2] < a[-3] and a[-2] < a[-1]:
        add_pattern('Vå­—å›å¾©', 'ä¸Šæ˜‡', 56, last_close + atr * 2.2)
    if len(a) >= 3 and a[-2] > a[-3] and a[-2] > a[-1]:
        add_pattern('é€†Vå­—', 'ä¸‹è½', 56, last_close - atr * 2.2)

    # 15-16 ãƒ¬ãƒ³ã‚¸ãƒ–ãƒ¬ã‚¤ã‚¯ï¼ˆä¸Š/ä¸‹ï¼‰
    if last_close > recent_high * 1.003:
        add_pattern('ãƒ¬ãƒ³ã‚¸ãƒ–ãƒ¬ã‚¤ã‚¯ä¸Š', 'ä¸Šæ˜‡', 60, last_close + (recent_high - recent_low))
    if last_close < recent_low * 0.997:
        add_pattern('ãƒ¬ãƒ³ã‚¸ãƒ–ãƒ¬ã‚¤ã‚¯ä¸‹', 'ä¸‹è½', 60, last_close - (recent_high - recent_low))

    # 17 ãƒ¬ãƒ³ã‚¸åç™º
    if abs(last_close - mid_range)/max(1e-9, mid_range) < 0.02:
        add_pattern('ãƒ¬ãƒ³ã‚¸åç™º', 'ä¸Šæ˜‡' if last_close>mid_range else 'ä¸‹è½', 51, mid_range)

    # 18-19 ã‚¦ã‚§ãƒƒã‚¸ï¼ˆä¸Šæ˜‡/ä¸‹é™ï¼‰ã®äºˆå…†ï¼ˆSMA20ã¨ä¾¡æ ¼ã®ç™ºæ•£/åæŸï¼‰
    slope20 = float(calc_sma(df['Close'],20).iloc[-1] - calc_sma(df['Close'],20).iloc[-5])
    if slope20>0 and last_close>ema21 and (sma20 - sma50) > 0:
        add_pattern('ä¸Šæ˜‡ã‚¦ã‚§ãƒƒã‚¸ï¼ˆè­¦æˆ’ï¼‰', 'ä¸‹è½', 54, last_close - atr * 2.0)
    if slope20<0 and last_close<ema21 and (sma20 - sma50) < 0:
        add_pattern('ä¸‹é™ã‚¦ã‚§ãƒƒã‚¸ï¼ˆåç™ºäºˆå…†ï¼‰', 'ä¸Šæ˜‡', 54, last_close + atr * 2.0)

    # 20-22 ãƒˆãƒ©ã‚¤ã‚¢ãƒ³ã‚°ãƒ«ï¼ˆä¸Šæ˜‡/ä¸‹é™/å¯¾ç§°ï¼‰è¿‘ä¼¼ï¼šé«˜å®‰ã®åæŸ
    width_now = recent_high - recent_low
    width_prev = (highs[-2*lookback:-lookback].max() - lows[-2*lookback:-lookback].min()) if len(highs) >= 2*lookback else width_now
    contracting = width_now < width_prev * 0.8
    if contracting:
        if trend_up:
            add_pattern('ä¸Šæ˜‡ãƒˆãƒ©ã‚¤ã‚¢ãƒ³ã‚°ãƒ«', 'ä¸Šæ˜‡', 58, last_close + width_now)
        if trend_dn:
            add_pattern('ä¸‹é™ãƒˆãƒ©ã‚¤ã‚¢ãƒ³ã‚°ãƒ«', 'ä¸‹è½', 58, last_close - width_now)
        add_pattern('å¯¾ç§°ãƒˆãƒ©ã‚¤ã‚¢ãƒ³ã‚°ãƒ«', 'ä¸Šæ˜‡' if trend_up else 'ä¸‹è½', 55, last_close + (width_now if trend_up else -width_now))

    # 23-24 ãƒãƒ£ãƒãƒ«ï¼ˆä¸Šæ˜‡/ä¸‹é™ï¼‰: SMAå‚¾ãã¨åå·®
    dev = last_close - sma20
    if trend_up and dev>0:
        add_pattern('ä¸Šæ˜‡ãƒãƒ£ãƒãƒ«', 'ä¸Šæ˜‡', 57, last_close + atr * 2.0)
    if trend_dn and dev<0:
        add_pattern('ä¸‹é™ãƒãƒ£ãƒãƒ«', 'ä¸‹è½', 57, last_close - atr * 2.0)

    # 25 ã‚«ãƒƒãƒ—ï¼†ãƒãƒ³ãƒ‰ãƒ«ï¼ˆç°¡æ˜“ï¼‰
    if len(a)>=15:
        mid15 = float(a[-8])
        if mid15 == min(a[-15:]) and trend_up:
            add_pattern('ã‚«ãƒƒãƒ—ï¼†ãƒãƒ³ãƒ‰ãƒ«', 'ä¸Šæ˜‡', 59, recent_high + atr * 2.5)

    # 26-27 ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰ï¼ˆãƒˆãƒƒãƒ—/ãƒœãƒˆãƒ ï¼‰è¿‘ä¼¼ï¼šç›´è¿‘ã§æ‹¡å¤§â†’åæŸ
    if len(a) >= 20:
        w1 = (highs[-20:-10].max() - lows[-20:-10].min())
        w2 = (highs[-10:].max() - lows[-10:].min())
        if w1 > 0 and w2 < w1*0.7:
            if trend_up:
                add_pattern('ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰ãƒˆãƒƒãƒ—', 'ä¸‹è½', 55, last_close - w2)
            else:
                add_pattern('ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰ãƒœãƒˆãƒ ', 'ä¸Šæ˜‡', 55, last_close + w2)

    # 28 ãƒ¡ã‚¬ãƒ›ãƒ³ï¼ˆãƒ–ãƒ­ãƒ¼ãƒ‰ãƒ‹ãƒ³ã‚°ï¼‰: ç›´è¿‘ã§æ‹¡å¤§
    if len(a) >= 20:
        w1 = (highs[-20:-10].max() - lows[-20:-10].min())
        w2 = (highs[-10:].max() - lows[-10:].min())
        if w2 > w1 * 1.2:
            add_pattern('ãƒ¡ã‚¬ãƒ›ãƒ³å‹', 'ä¸‹è½' if rsi>65 else 'ä¸Šæ˜‡', 54, last_close + (atr * ( -2.0 if rsi>65 else 2.0)))

    # 29-30 ã‚¨ã‚¯ã‚¹ãƒ‘ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒˆãƒ©ã‚¤ã‚¢ãƒ³ã‚°ãƒ«/ãƒœãƒƒã‚¯ã‚¹ãƒ¬ãƒ³ã‚¸
    if w2 > w1 and not contracting:
        add_pattern('ã‚¨ã‚¯ã‚¹ãƒ‘ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒˆãƒ©ã‚¤ã‚¢ãƒ³ã‚°ãƒ«', 'ä¸Šæ˜‡' if trend_up else 'ä¸‹è½', 52, last_close + (width_now if trend_up else -width_now))
    # ãƒœãƒƒã‚¯ã‚¹ï¼ˆæ¨ªã°ã„ï¼‰
    if abs(last_close - mid_range)/max(1e-9, mid_range) < 0.01 and not contracting:
        add_pattern('ãƒœãƒƒã‚¯ã‚¹ãƒ¬ãƒ³ã‚¸ç¶­æŒ', 'ä¸Šæ˜‡' if last_close>mid_range else 'ä¸‹è½', 50, mid_range)

    return patterns

# ------------------- ã‚µã‚¤ãƒ‰ãƒãƒ¼ / UI -------------------
st.sidebar.header("âš™ï¸ ã‚ªãƒ—ã‚·ãƒ§ãƒ³")
symbol = st.sidebar.text_input("éŠ˜æŸ„ã‚³ãƒ¼ãƒ‰", "AAPL")
period = st.sidebar.selectbox("æœŸé–“", ["6mo","1y","2y","5y"], index=1)
lookback = st.sidebar.slider("äºˆæ¸¬ã«ä½¿ã†ç›´è¿‘æœ¬æ•°", min_value=20, max_value=120, value=60, step=5)
risk_mult = st.sidebar.slider("ãƒªã‚¹ã‚¯ä¿‚æ•° (SL/TPã®ã‚¹ã‚±ãƒ¼ãƒ«)", 0.5, 2.0, 1.0, 0.1)
use_atr = st.sidebar.checkbox("ATRã‚’ä½¿ã£ã¦TP/SLã‚’èª¿æ•´", value=True)
show_all = st.sidebar.checkbox("ä¸Šä½ã ã‘ã§ãªãå…¨ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’è¡¨ç¤º", value=False)
run = st.sidebar.button("æœªæ¥äºˆæ¸¬ã‚’å®Ÿè¡Œ")

st.markdown("ç›´è¿‘ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰30ç¨®ã®ãƒãƒ£ãƒ¼ãƒˆå½¢çŠ¶ã‚’ **æœªæ¥äºˆæ¸¬** ã¨ã—ã¦ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°ã€‚å„ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ã‚¨ãƒ³ãƒˆãƒªãƒ¼/åˆ©ç¢º/æåˆ‡ã‚Šã‚’ç®—å‡ºã—ã€ä¿¡é ¼åº¦é †ã§æç¤ºã—ã¾ã™ã€‚â€»ã‚ãã¾ã§å‚è€ƒãƒ»ç ”ç©¶ç”¨ã§ã™ã€‚")

placeholder_table = st.empty()
placeholder_chart = st.empty()

if run:
    try:
        df = yf.download(symbol, period=period, interval="1d", progress=False).dropna()
        if df.empty:
            st.error("ãƒ‡ãƒ¼ã‚¿å–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ")
            st.stop()

        # æŒ‡æ¨™
        df['SMA20'] = calc_sma(df['Close'],20)
        df['SMA50'] = calc_sma(df['Close'],50)
        df['EMA21'] = calc_ema(df['Close'],21)
        df['RSI'] = calc_rsi(df['Close'])
        df['ATR'] = calc_atr(df)

        patterns = predict_future_trade_patterns(df, lookback=lookback, risk_mult=risk_mult, use_atr=use_atr)
        if not patterns:
            st.warning("ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯æ¤œå‡ºã•ã‚Œã¾ã›ã‚“ã§ã—ãŸ")
        else:
            # ä¿¡é ¼åº¦â†’RRã§ä¸¦ã³æ›¿ãˆï¼ˆä¿¡é ¼åº¦å„ªå…ˆã€åŒç‡ãªã‚‰RRé™é †ï¼‰
            patterns_sorted = sorted(patterns, key=lambda x: (x.get('confidence',50), x.get('rr',1.0)), reverse=True)
            top = patterns_sorted if show_all else patterns_sorted[:5]

            table_rows = []
            for p in top:
                table_rows.append({
                    'ãƒ‘ã‚¿ãƒ¼ãƒ³': p['name'],
                    'ç¨®åˆ¥': p['kind'],
                    'ä¿¡é ¼åº¦(%)': p['confidence'],
                    'ã‚¨ãƒ³ãƒˆãƒªãƒ¼': format_price(p['entry']),
                    'åˆ©ç¢ºç›®å®‰': format_price(p['tp']),
                    'æåˆ‡ã‚Š': format_price(p['sl']),
                    'æƒ³å®šRR': round(float(p['rr']),2)
                })
            placeholder_table.subheader("ğŸ” ä¿¡é ¼åº¦é †ã®å€™è£œ")
            placeholder_table.table(pd.DataFrame(table_rows))

            # æç”»
            fig, ax = plt.subplots(figsize=(14,6))
            ax.plot(df.index, df['Close'], label='Close', color='tab:blue')
            ax.plot(df.index, df['SMA20'], label='SMA20', color='tab:orange')
            ax.plot(df.index, df['SMA50'], label='SMA50', color='tab:green')
            ax.grid(alpha=0.2)
            ax.set_title(f"{symbol} - {period} ãƒãƒ£ãƒ¼ãƒˆã¨æœªæ¥äºˆæ¸¬")

            last_x = df.index[-1]
            last_price = float(df['Close'].iloc[-1])

            # çŸ¢å°ã¨ç›®å°ï¼ˆã‚¨ãƒ³ãƒˆãƒªãƒ¼/TP/SLï¼‰
            for p in top:
                color = 'green' if p['kind']=='ä¸Šæ˜‡' else 'red'
                ax.annotate(f"{'â†‘' if p['kind']=='ä¸Šæ˜‡' else 'â†“'}{p['name']} ({p['confidence']}%)",
                            xy=(last_x, last_price),
                            xytext=(last_x, float(p['tp'])),
                            arrowprops=dict(facecolor=color, shrink=0.05),
                            fontsize=9)
                # æ°´å¹³ãƒ©ã‚¤ãƒ³
                ax.axhline(float(p['entry']), linestyle='--', alpha=0.3, label=f"Entry:{p['name']}")
                ax.axhline(float(p['tp']), linestyle='-', alpha=0.25, label=f"TP:{p['name']}")
                ax.axhline(float(p['sl']), linestyle=':', alpha=0.25, label=f"SL:{p['name']}")

            ax.legend(loc='upper left', ncol=3, fontsize=8)
            placeholder_chart.pyplot(fig)

            # æ³¨è¨˜
            st.info("â€» æœ¬ãƒ„ãƒ¼ãƒ«ã¯å‚è€ƒç”¨ã®å®šç¾©ãƒ™ãƒ¼ã‚¹æ¨å®šã§ã™ã€‚å®Ÿé‹ç”¨ã§ã¯å‡ºæ¥é«˜ãƒ»ã‚®ãƒ£ãƒƒãƒ—ãƒ»ã‚¤ãƒ™ãƒ³ãƒˆç­‰ã‚‚å¿…ãšè€ƒæ…®ã—ã¦ãã ã•ã„ã€‚")

    except Exception as e:
        st.error(f"ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ: {e}")
